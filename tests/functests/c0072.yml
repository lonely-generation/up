goal:
  - add cmd cmd template as a shortcut to render file
  - test case shows that you can use vars in src and dest
  -

vars:
  name: little prince
  school: sydney grammar
  age: 12
  said: Boa constrictors swallow their prey whole
  save_to: /tmp/mystory2.txt
  read_dir: /tmp
  read_file: mystory2.txt

dvars:
  - name: intest
    value: '{{ env "GOTEST" |default "false" }}'

tasks:

  - name: task
    task:
      - func: shell
        do:
          - echo "?intest ->  {{.intest}}"
          - pwd
        reg: register_task_root

      - func: cmd
        do:
          - name: print
            cmd: 'intest is: [{{.intest}}]'

          - name: reg
            cmd:
              name: correct_working_dir
              desc: the value of .intest is string but not bool so you can not simple use if .intest for condition
              value: >-
                {{if eq .intest "true" }}{{.register_task_root}}{{else}}{{.register_task_root}}{{end}}

      - func: cmd
        do:
          - name: print
            cmd: 'root dir is: [{{.register_task_root}}]'

          - name: print
            cmd: 'correct working dir is: [{{.correct_working_dir}}]'

          -
            name: template
            desc: render a template file to a file 1
            cmd:
              src: '{{.correct_working_dir}}/tests/functests/d0072.template'
              dest: /tmp/mystory.txt

          -
            name: readfile
            desc: read content of a file and register it to a var
            cmd:
              filename: mystory.txt
              dir: /tmp
              reg: my_interesting_story

          -
            name: print
            cmd: "{{.my_interesting_story}}"

      - func: cmd
        do:

          -
            name: template
            desc: render a template file to a file 2
            cmd:
              src: '{{.correct_working_dir}}/tests/functests/d0072.template'
              dest: '{{.save_to}}'

          -
            name: readfile
            desc: read content of a file and register it to a var
            cmd:
              filename: '{{.read_file}}'
              dir: '{{.read_dir}}'
              reg: my_interesting_story2

          -
            name: print
            cmd: "{{.my_interesting_story2}}"

